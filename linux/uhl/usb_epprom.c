#include "uhl.h"

static byte output_1[] = { 0x0cu, 0x00u, 0x00u };
static byte output_2[] =
{
  0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u,
  0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u,
  0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u,
  0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u,
  0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u,
  0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u,
  0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u, 0x00u
};

#define EPPROM_PAGE_SIZE 256

boolean uhl_usb_epprom(usb_type *usb, memory_type *memory)
{
  int i;

  output_1[2] = memory->size[MEMORY_INDEX_EPPROM]/EPPROM_PAGE_SIZE;
  if(uhl_set_descriptor_request(usb, output_1, sizeof(output_1)) != sizeof(output_1))
    return FALSE;
  for(i = 0; i < memory->size[MEMORY_INDEX_EPPROM]; i++)
  {
    output_2[0] = memory->memory_epprom[i];
    if(uhl_set_descriptor_request(usb, output_2, sizeof(output_2)) != sizeof(output_2))
      return FALSE;
  }
  return TRUE;
}
